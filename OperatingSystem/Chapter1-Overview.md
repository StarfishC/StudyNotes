# 概述

**概览：**

**[:question: 操作系统的基本概念](#基本概念)**  
**[:question: 操作系统的发展与分类](#发展与分类)**  
**[:question: 操作系统的运行环境](#运行环境)**  
**[:question: 大内核与微内核](#大内核与微内核)**  

## 基本概念

### 操作系统的定义

操作系统是控制和管理整个计算机系统的硬件与软件资源、合理地组合和调度计算机地工作与资源、为用户和其他软件提供方便接口与环境地程序集合

### 操作系统的特征

操作系统的基本特征有：并发、共享、虚拟、异步

#### 并发

- 两个或多个事件在同一时间间隔内发生
- 使得系统具有处理和调度多个程序同时执行的能力
- 操作系统的并发是通过分时实现的
- 注意：并发是指在一个时间段、并行是指在同一个时刻；并行是指系统具有同时执行或操作
- 单核CPU同一时刻只能执行一个程序，各个程序可以并行地执行；多核CPU同一时刻可以同时执行多个程序，多个程序可以并行的执行

#### 共享

| 互斥共享 | 同时访问方式 |
| ------- | ---------- |
| 例如打印机、磁带等，同一时刻只能供一个进程对资源进行方向<br> 这种资源称作临界资源或独占资源 | 例如：磁盘设备、重入编码写的文件等 <br>一段时间内允许多个进程对资源进行访问 |

#### 虚拟

一个物理上的实体变为若干逻辑上的对应物，这种技术也被称为虚拟技术

- 时分复用技术-虚拟处理器：采用多道程序并发的方式，让每个终端用户感觉到有多个处理器
- 空分复用技术-虚拟存储器：将物理存储变为虚拟存储器，逻辑上扩充存储器用量
- 也可以将一台IO设备虚拟为多台逻辑上的IO设备，并允许每个用户占用一台逻辑上的IO设备

#### 异步

多道程序走走停停，进程以不可预知的速度向前推进

### 操作系统的目标和功能

#### 管理功能

| 处理机管理 | 存储器管理 | 文件管理 | 设备管理 |
| --------- | -------- | -------- | ------- |
| 管理处理机的分配与允许，解决冲突问题，可以理解为对进程的管理 <br> 进程管理：进程控制、进程同步、进程通信、死锁处理、处理及调度 | 为了提高多道程序允许效率，方便用户使用 <br> 内存分配、地址映射、内存保护、内存共享和内容扩充 | 操作系统负责管理文件的系统称为文件系统 <br> 文件存储空间的管理、目录管理、文件读写管理和保护 | 完成用户的IO请求，方便用户使用设备，提高设备的利用率<br> 缓冲管理、设备分配、设备处理、虚拟设备 |

#### 接口功能

- 命令接口
  - 联机控制方式：交互式命令接口，适用于分时或实时系统，就像人与机器对话一样
  - 脱机控制方式：又称批处理系统，提交一组作业，系统进行处理，用户不能干预作业的运行
- 程序接口：有一组系统调用的命令组成（也称作系统调用或广义指令），例如GUI（图像用户界面）

#### 操作系统用作扩充机器

操作系统提供了资源管理功能和方便用户使用的各种服务功能，将机器改造为功能更强的机器  
覆盖了软件的机器称为扩充机器，又称之为虚拟机

#### 封装思想

操作系统把一些丑陋的硬件功能封装成简单易用的服务，使用户能更方便地使用计算机，用户无需关心底层硬件地原理，只需要对操作系统发出命令即可

## 发展与分类

手工阶段->批处理阶段->分时操作系统->实时操作系统->分布式计算系统->个人操作系统

### 手工阶段

程序的装入、运行和结果的输出都需要认为干涉  
缺点：资源利用率低、CPU利用不充分

### 批处理阶段

为了解决人机矛盾以及CPU和IO设备之间速度不匹配的矛盾

| | 单道批处理系统 | 多道批处理系统 |
|-| ------------ | ------------ |
| 概念 | 内存中始终保存一道作业 | 允许多个程在CPU中交替运行，程序共享各种硬件和软件资源 |
| 特点 | 自动性：一批作业自动执行不需要人工干预 <br> 顺序性：各道作业依次执行 <br> 单道性：仅有一道程序执行 | 多道：计算机中同时存放多道相互独立的程序 <br> 宏观上并行：多道程序都会开始运行，但没有运行完毕<br> 微观上串行：多道程序轮流占有CPU，较低执行 |
| 优点 | 缓解了一定成都的人机速度矛盾，资源利用率有所提升 | 资源利用率高、多道程序并发执行，共享计算机资源、CPU和其他资源更能保持"忙碌"状态，系统吞吐量增大 |
| 缺点 | 高速CPU等待IO设备的完成<br> 内存中仅能有一道程序运行，只有该程序运行结束后才能调入下一道程序 | 设计复杂，要考虑各种资源调度问题 <br> 响应时间过长，没有人机交互功能 |

### 分时操作系统

将处理器运行时间划分为时间片，将时间片分配给不同作业/用户从而占用处理机

特点：

- 同时性：允许多个终端用户使用同一台计算机
- 交互性：方便进行人机对话，采用人机对话方式控制程序运行
- 独立性：多个用户彼此之间独立的操作，互不干扰
- 及时性：用户请求能在很短时间内获得响应

### 实时操作系统

保证在规定时间内完成某项任务

特点：

- 及时性：规定时间内完成规定任务
- 可靠性：输出的结果正确，系统运行时确保稳定

### 分布式计算机系统

网络操作系统将多个计算机有机的结合在一起；任意两台计算机之间没有主从之分，互相交换信息，并行工作，协同完成

### 个人操作系统

广泛应用于文字处理、电子表格、游戏

## 运行环境

### 程序运行

程序运行的过程就是CPU执行一条一条机器指令的过程

### 操作系统的运行机制

- CPU执行的两种性质程序：操作系统内核程序、用户自编程序
- 内核
  - 时钟管理：操作系统对用户提供标准时间，根据时钟对进程进行管理，实现进程切换
  - 中断机制：初衷是为了提高多道程序运行环境中的CPU里用户；保护和恢复中断现场的信息，转移控制权到相关程序
  - 原语
    - 处于系统的最底层，最接近硬件
    - 运行具有原子性，只能一气呵成
    - 系统控制的数据结构及处理
      - 进程管理：进程状态管理、进程调度和分派、创建和撤销进程控制块
      - 存储器管理：存储器的空间分配和回收、内存信息保护程序、代码对换程序
      - 设备管理：缓冲区管理、设备分配和回收

### 中断与异常

- 为了进行核心态和用户态两种状态切换，引入了中断机制
  - 核心态和可以执行用户态无法执行的特权指令
  - 访管指令是在用户态使用，将用户态转换为核心态，所以访管指令不是特权指令
- 中断是操作系统内核夺回CPU使用权的唯一途径
- 中断（外中断）
  - 来自CPU指令之外的事件发生
  - IO中断：输入输出以及完成
  - 时钟中断：固定时间片已到，让处理机处理
- 异常（内中断）
  - 源自于CPU执行指令内部的时间
  - 非法操作码、除零、地址越界、算数溢出
  - 陷入指令：用户自行设置，执行陷入后，用户态转为核心态
  - 异常不能被屏蔽
  
### 系统调用

用户在程序中调用操作系统提供的一些子功能

- 设备功能：完成设备的请求或释放，设备启动等功能
- 文件管理：完成文件的读、写、创建和删除功能
- 进程控制：完成进程的创建、撤销、阻塞以及唤醒功能
- 进程通信：完成进程之间的消息传递和信号传送功能
- 内存管理：完成内存的分配、回收以及获取作业占用内存区大小及始址等功能

### 用户态于内核态

CPU中有一个寄存器叫程序状态寄存器(psw)，其中有个二进制位，1表示内核态，0表示用户态

- 处于内核态时，说明此时正在运行的是内核程序，此时可以执行特权指令
- 处于用户态是，说明此时正在运行的是应用程序，此时只能执行非特权指令

内核态=核心态=管态；用户态=目态

内核态于用户态的切换

- 内核态->用户态：执行一条特权指令：修改PSW的标志位为用户态，这个动作意味着操作系统将主动让出CPU使用权
- 用户态->内核态：由中断引发，硬件自动完成变态过程，触发中断信号因为这操作系统将强行夺回CPU的使用权

## 大内核与微内核

|  | 大内核 | 微内核 |
| - | ---- | ------ |
| 概念 | 将操作系统的主要功能模块进行集中，从而用以提高性能的系统服务 | 背景：随着计算机系统结构的不断发展，操作系统提供的服务越来越多，接口形式越来越复杂 <br> 将内核中的最基本的功能（如：进程管理）保留在内核，将不需要在核心态执行的功能转移到用户态执行，降低内核设计的复杂性 |
| 优点 | 各个管理模块之间共享信息，能够有效利用相互之间的有效特性，所以有着巨大的性能优势 | 有效的分离内核与服务、服务与服务、使得他们之间的接口更加的清晰，维护的代价大大降低<br> 各部分可以独立的优化和演进 |
| 缺点 | 层次交互关系复杂，层次接口难以定义，层次之间界限模糊 | 性能问题，需要频繁的在核心态与用户态之间进行切换 |
